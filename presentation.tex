\documentclass[aspectratio=169,10pt]{beamer}
\mode<presentation>
{
  %%\usetheme{Copenhagen}
  \usetheme{Warsaw}
  %%\setbeamercovered{transparent}
}

\setcounter{tocdepth}{1}
\AtBeginSection[]
{
  \begin{frame}<beamer>
    \frametitle{Contenido de la charla}
    \tableofcontents[currentsection,currentsubsection]
  \end{frame}
}
\usepackage[utf8]{inputenc}
\usepackage{times}
\usepackage[T1]{fontenc}
\usepackage[scanall]{psfrag}
\usepackage{bibunits}
\usepackage[spanish]{babel} 
\usepackage{listings}
\usepackage{xcolor}
\usepackage{pgf,pgffor} 

\lstdefinestyle{base}{  breaklines=true,
                    basicstyle=\footnotesize,
                    numbers=left,
                    numberstyle=\tiny, numbersep=5pt,
                    breaklines=true,
                    tabsize=2, captionpos=b , stepnumber=1,aboveskip=0pt, belowskip=0pt,
                    moredelim=**[is][\color{red}]{@}{@},
                    moredelim=**[is][\color{blue}]{@2}{@},
                    moredelim=**[is][\only<4->{\color{green}}]{@4}{@},
                    moredelim=**[is][\only<5->{\color{blue}}]{@5}{@},
        }

\title{Aplanado eficiente de grandes modelos Modelica}
\author[M.Botta] {Mariano Botta } 
\institute[UNR] % (optional, but mostly needed)
{ FCEIA, UNR }
\date {Agosto 2015}

\subject{Talks}
\begin{document}

\begin{frame}
  \titlepage
\end{frame}

 
\section{Motivaciones}  

\begin{frame}{Motivaciones}
    \begin{itemize}
     \item Modelado, Simulación y Control en Tiempo Real con Aplicaciones en Electrónica de Potencia.
     \item Simulación en paralelo utilizando los métodos de cuantificación de estado.  
     \item Modelos grandes.
     \item Aprovechar las ventajas de Modelica.
    \end{itemize}
\end{frame}

\section{Introducción a Modelica}

\begin{frame}{Modelica} 
    \begin{itemize}
        \item Orientado a Objetos.
        \item Modelado de sistemas complejos, con componentes mecánicos, eléctricos, electrónicos, hidráulicos, térmicos, etc.     
        \item Desarrollado por la asociación sin fines de lucro ``Modelica Asociation''.
        \item Entornos de desarrollo: OpenModelica, MathModelica, Dymola, etc.
        
        \item El modelo está en texto plano
    \end{itemize}
\end{frame}
 

\begin{frame}[fragile]
\frametitle{Clases} 
\begin{columns}  
\column{.5\textwidth}  
\begin{itemize}
    \item Define un objeto.
    \item Son instanciadas mediante la definición de variables.
    \item Tienen tres secciones:
        \begin{enumerate}
            \item Definiciones.
            \item Ecuaciones.
            \item Sentencias.
        \end{enumerate}
\end{itemize}

\column{.5\textwidth}
\begin{lstlisting}[style=base]
    class X
        // Definiciones de variables y clases   
    equation
        // Ecuaciones
    statements
        // Sentencias
    end X;   
\end{lstlisting}
\end{columns}
\end{frame}

\begin{frame}[fragile]
\frametitle{Prefijos de Clases} 
Prefijos de clase: \textit{model}, \textit{record}, \textit{block}, \textit{connector}, \textit{function}, \textit{package}
\begin{itemize}
    \item Mejoran la lectura del código:
    \item Agregan restricciones a la clase
\end{itemize}   

\begin{columns}  
\column{.5\textwidth}  
\begin{lstlisting}[style=base]
    class Circuits
        cclass Pin
            Real v;
            flow Real i;
        end Pin;
        class Componente
            Pin n,p;
        equation 
            n.v = p.v;
        end Componente; 
    end Circuits;   
\end{lstlisting}
\par

\column{.5\textwidth}
\begin{lstlisting}[style=base]
    @package@ Circuits
        @connector@ Pin
            Real v;
            flow Real i;
        end Pin;
        @model@ Componente
            Pin n,p;
        equation 
            n.v = p.v;
        end Componente; 
    end Circuits;   
\end{lstlisting}
\par
\end{columns}
\end{frame}

\begin{frame}[fragile]
\frametitle{Herencias de Clases} 
\begin{columns}  
\column[t]{.5\textwidth}  

\begin{itemize}
    \item Agrega significado semántico al modelo.
    \item Facilita la reutilización de código.
    \item Se utiliza la palabra reservada: \textit{extends}.
\end{itemize} 

\column[t]{.5\textwidth}  
\begin{lstlisting}[style=base]
model OnePort
    Pin p;
    Pin n;
    Real v;
    Real i;
equation
    v = p.v - n.v;
    i = p.i;
    i = -n.i;
end OnePort;
model Capacitor
    @extends@ OnePort;
    parameter Real C = 1;
equation
    C * der(v) = i;
end Capacitor;
\end{lstlisting}
\end{columns}
\end{frame}

\begin{frame}[fragile]
\frametitle{Declaraciones de tipo} 
\begin{columns}  
\column[t]{8cm}
    \begin{itemize}
        \item Tipos básicos: \textit{Real}, \textit{Integer}, \textit{Boolean} y \textit{String}
        \item Las clases definen un nuevo tipo.
        \item Sinónimos de tipos: \\ 
              type Nombre = [Prefijos] Tipo-Existente [Array] [Modificaciones]
    \end{itemize} 

Prefijos de Tipo: \textit{flow}, \textit{constant}, \textit{parameter}, \textit{discrete}, \textit{input} y \textit{output}.

\column[t]{5cm}
\begin{lstlisting}[style=base]
package Circuits
    type Current = flow Real;
    type Voltage = Real;
    connector Pin
        Voltage v;
        Current i;
    end Pin;
    type TenPin = Pin[10];
end Circuits;
\end{lstlisting}
\par
\end{columns}
\end{frame}

\begin{frame}[fragile]
\frametitle{Definiciones de variables} 
\begin{enumerate}
\item \textbf{Prefijos de tipos}: \textit{flow}, \textit{constant}, \textit{parameter}, \textit{discrete}, \textit{input} y \textit{output}.
\item \textbf{Tipo}: Nombre del tipo de la variable. Puede ser un tipo básico, una clase o un sinónimo de tipo.  Ejemplo: \textit{Real}, \textit{String}, \textit{Pin}, \textit{TenPin}.
\item \textbf{Nombre de la variable}. 
\item \textbf{Dimensión}: Modelica permite la definición de arreglos.
\item \textbf{Modificaciones}.
\end{enumerate}
\begin{lstlisting}[style=base]
    type TenPin = Pin[10];  
    
    TenPin pines;
    Pin pines2 [10];
\end{lstlisting}
\par

\end{frame}

\begin{frame}[fragile]
\frametitle{Modificaciones} 

\begin{columns}  
\column[T]{7cm}
Aparecen en: 
\begin{enumerate}
    \item Declaraciones de variables.
    \item Sinónimo de tipo.
    \item Definiciones de herencia.
\end{enumerate} 

Se permite:
\begin{enumerate}
    \item Cambiar el valor inicial de una variable.
    \item Anidar modificaciones.
    \item Alterar la definición de una variable.
    \item Cambiar la definición de un tipo.
\end{enumerate}
\column[T]{7cm}
\begin{lstlisting}[style=base]
package Circuits
    model CircuitX
        Capacitor cap;
        Resistor res;
        ...
    equation 
    
    ...
        
    end CircuitX;
    model MainCircuit
        Capacitor x(C = 2);
        CircuitOne co1 (cap(C = 10));
        CircuitOne co2 (cap(C = 15));
    end MainCircuit;
end Circuits;
\end{lstlisting}

 
\end{columns}
\end{frame}

\begin{frame}[fragile]
\frametitle{Ecuaciones de igualdad} 

Las ecuaciones no representan una asignación, sino igualdades. Pueden tener expresiones complejas de ambos lados de la igualdad y expresan una relación entre las variables. 

\begin{columns}  
\column[t]{8cm}
Igualdades
\begin{lstlisting}[style=base]
    p.v - n.v = v;
    i = p.i;
    i = -n.i;
\end{lstlisting} 
\column[t]{5cm}
Ecuación For
\begin{lstlisting}[style=base]
    for i in 1:N loop
        v[i] = p[i].v - n[i].v;
        i[i] = p[i].i;
        i[i] = -n[i].i;
        C[i] * der(v[i]) = i;
    end for;
\end{lstlisting} 
\end{columns}


\end{frame}

\begin{frame}[fragile]
\frametitle{Ecuaciones Connect} 
Los conectores:
\begin{itemize}
\item Son clases con ciertas restricciones.
\item Se definen con el prefijo \textit{connector}.
\item No tienen ecuaciones.
\item Tienen variables de dos tipos:
    \begin{enumerate}
        \item Variables de potencial. Ejemplo: presión, voltaje, etc. 
        \item Variables de flujo: definidas con el prefijo flow. Ejemplo: corriente, caudal, etc.
    \end{enumerate}
\item Ejemplo: Clase \textit{Pin}.
\end{itemize}

\end{frame}

\begin{frame}[fragile]
\frametitle{Ecuaciones Connect} 
Las ecuaciones \textit{connect}: 
\begin{itemize}
\item Conectan dos clases del mismo tipo.
\item Genera relaciones entre las variables internas de los conectores:
\begin{itemize}
\item Las variables de potencial dentro de una misma conexión deben ser iguales entre sí.
\item Las variables de flujo siguen las reglas de Kirchhoff: la suma de los flujos es igual a cero. Para mantener esta regla hay que considerar como flujo positivo aquel que tenga dirección hacia dentro del componente. En caso contrario, será considerado negativo. 
\end{itemize}
\end{itemize}
\end{frame}

\begin{frame}[fragile]
\frametitle{Ecuaciones Connect} 
\begin{columns}  
\column[T]{8cm}
 \begin{lstlisting}[style=base,,basicstyle=\tiny]
    package Circuits
        ...
        model ground
            Pin p;
        equation
            p.v = 0;
        end ground;
        model inductor
            extends OnePort;
            parameter Real L = 1;
        equation
            L * der(i) = v;
        end inductor;
        model LC_circuit
            Capacitor cap(v(start = 1));
            inductor ind(L = 2);
            ground gr;
        equation
            connect(ind.p,cap.p);
            connect(ind.n,cap.n);
            connect(cap.n,gr.p);
        end LC_circuit;
    end Circuits
\end{lstlisting}
\column[T]{6cm}
 \begin{lstlisting}[style=base]
    // Variables de Potencial
    ind.p.v = cap.p.v;
    ind.n.v  = cap.n.v;
    cap.n.v = gr.p.v;
    
    // Variables de flujo
    ind.p.i + cap.p.i = 0;
    ind.n.i + cap.n.i + gr.p.i = 0;
\end{lstlisting}
\end{columns}
\end{frame}

\section{Simulación y problemas}

\begin{frame}[fragile]
\frametitle{Simulación de Modelos Modelica} 
    \begin{figure}
      \centering
      \includegraphics[scale=0.5]{Compilacion} 
      \label{fig:proceso}
    \end{figure}
\end{frame}


%% [FALTA] Esta no estoy seguro
\begin{frame}[fragile]
\frametitle{Modelica Compiler} 
 Las ecuaciones de un modelo deben ser representadas como Ecuaciones Diferenciales Ordinarias (ODE): 
 \begin{enumerate}
 \item \textbf{Aplanado del modelo}.
 \item \textbf{Reducción de las conexiones}.
 \end{enumerate}
 
\end{frame}

\begin{frame}[fragile]
\frametitle{Tama\~no de un modelo} 
\begin{itemize}
    \item Tamaño físico: Cantidad de clases, variables, ecuaciones, etc. usadas.
    \item Tamaño lógico: Consideramos la dimensionalidad del modelo.
\end{itemize}
 
\uncover<2->{ 
\begin{center} 
    \LARGE Queremos trabajar con grandes dimensionalidades 
\end{center}
}
\end{frame}


\input{cap3}
\input{cap4}


\end{document}
    
\begin{comment}

\begin{frame}[fragile]
\frametitle{Declaraciones de variables} 
\begin{columns}  
\column[t]{8cm}
 
\column[t]{5cm}
 
\end{columns}
\end{frame}

\end{comment}
